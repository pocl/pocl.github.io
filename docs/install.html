
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Installation &#8212; Portable Computing Language (PoCL) 6.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Usage" href="using.html" />
    <link rel="prev" title="Welcome to Portable Computing Language (pocl)’s documentation!" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="using.html" title="Usage"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to Portable Computing Language (pocl)’s documentation!"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Portable Computing Language (PoCL) 6.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Installation</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="installation">
<span id="pocl-install"></span><h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>In order to build pocl, you need the following support libraries and
tools:</p>
<blockquote>
<div><ul class="simple">
<li><p>A supported version of LLVM &amp; Clang (check release notes)</p></li>
<li><p>development files for LLVM &amp; Clang + their transitive dependencies
(e.g. libclang-dev, libllvm-dev, zlib1g-dev, libtinfo-dev…)</p></li>
<li><p>CMake</p></li>
<li><p>GNU make or ninja</p></li>
<li><p>pkg-config</p></li>
<li><p>pthread (should be installed by default)</p></li>
<li><p>hwloc v1.0 or newer (e.g. libhwloc-dev) - optional</p></li>
<li><p>python3 (for support of LLVM bitcode with SPIR target; optional but enabled by default)</p></li>
<li><p>python3, llvm-spirv (version-compatible with LLVM) and spirv-tools (optional;
required for SPIR-V support in CPU / CUDA; Vulkan driver supports SPIR-V through clspv)</p></li>
</ul>
</div></blockquote>
</section>
<section id="installing-requirements-for-ubuntu">
<h2>Installing requirements for Ubuntu<a class="headerlink" href="#installing-requirements-for-ubuntu" title="Permalink to this headline">¶</a></h2>
<p>Note: The binary packages from <a class="reference external" href="https://apt.llvm.org/">https://apt.llvm.org/</a> are recommended
(and tested for each release) instead of the binary tar balls or
the packages included in the distribution. The following assumes
apt.llvm.org is added to your apt repos:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>apt install -y python3-dev libpython3-dev build-essential ocl-icd-libopencl1 cmake git pkg-config libclang-${LLVM_VERSION}-dev clang-${LLVM_VERSION} llvm-${LLVM_VERSION} make ninja-build ocl-icd-libopencl1 ocl-icd-dev ocl-icd-opencl-dev libhwloc-dev zlib1g zlib1g-dev clinfo dialog apt-utils libxml2-dev libclang-cpp${LLVM_VERSION}-dev libclang-cpp${LLVM_VERSION} llvm-${LLVM_VERSION}-dev
</pre></div>
</div>
<p>Installing requirements for Arch Linux:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">gcc</span> <span class="n">patch</span> <span class="n">hwloc</span> <span class="n">cmake</span> <span class="n">git</span> <span class="n">pkg</span><span class="o">-</span><span class="n">config</span> <span class="n">make</span> <span class="n">ninja</span> <span class="n">ocl</span><span class="o">-</span><span class="n">icd</span> <span class="n">clang</span> <span class="n">llvm</span> <span class="n">llvm</span><span class="o">-</span><span class="n">libs</span> <span class="n">clinfo</span> <span class="n">opencl</span><span class="o">-</span><span class="n">headers</span>
</pre></div>
</div>
<p>Installing requirements for Fedora:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dnf</span> <span class="n">install</span> <span class="n">gcc</span> <span class="n">gcc</span><span class="o">-</span><span class="n">c</span><span class="o">++</span> <span class="n">clinfo</span> <span class="n">hwloc</span><span class="o">-</span><span class="n">devel</span> <span class="n">hwloc</span><span class="o">-</span><span class="n">libs</span> <span class="n">cmake</span> <span class="n">git</span><span class="o">-</span><span class="n">core</span> <span class="n">pkgconfig</span> <span class="n">make</span> <span class="n">ninja</span><span class="o">-</span><span class="n">build</span> <span class="n">ocl</span><span class="o">-</span><span class="n">icd</span> <span class="n">ocl</span><span class="o">-</span><span class="n">icd</span><span class="o">-</span><span class="n">devel</span> <span class="n">clang</span> <span class="n">clang</span><span class="o">-</span><span class="n">devel</span> <span class="n">clang</span><span class="o">-</span><span class="n">libs</span> <span class="n">llvm</span> <span class="n">llvm</span><span class="o">-</span><span class="n">devel</span> <span class="n">llvm</span><span class="o">-</span><span class="n">libs</span> <span class="n">patch</span> <span class="n">redhat</span><span class="o">-</span><span class="n">rpm</span><span class="o">-</span><span class="n">config</span> <span class="n">findutils</span>
</pre></div>
</div>
<p>There are also Dockerfiles available for a few most common linux
distributions in <code class="docutils literal notranslate"><span class="pre">tools/docker</span></code>, looking into them might be helpful.</p>
</section>
<section id="opencl-3-0-support">
<h2>OpenCL 3.0 support<a class="headerlink" href="#opencl-3-0-support" title="Permalink to this headline">¶</a></h2>
<p>If you want PoCL built with ICD and OpenCL 3.0 support at platform level, you will
need sufficiently new ocl-icd (2.3.x). For Ubuntu, it can be installed from
this PPA: <a class="reference external" href="https://launchpad.net/~ocl-icd/+archive/ubuntu/ppa">https://launchpad.net/~ocl-icd/+archive/ubuntu/ppa</a>
Additionally, if you want the CPU device to report as 3.0 OpenCL,
you will need LLVM 14 or newer.</p>
<p>Note: PoCL assumes that the OpenCL development headers and the ICD loader
(if present on your system) are version compatible.</p>
</section>
<section id="clang-llvm-notes">
<h2>Clang / LLVM Notes<a class="headerlink" href="#clang-llvm-notes" title="Permalink to this headline">¶</a></h2>
<p><strong>IMPORTANT NOTE!</strong> Some targets (TCE and possibly HSA) require that
you compile &amp; build LLVM with RTTI on. It can be enabled on cmake command
line, as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="p">[</span><span class="n">other</span> <span class="n">CMake</span> <span class="n">options</span><span class="p">]</span> <span class="o">-</span><span class="n">DLLVM_ENABLE_RTTI</span><span class="o">=</span><span class="n">ON</span> <span class="o">-</span><span class="n">DLLVM_ENABLE_EH</span><span class="o">=</span><span class="n">ON</span> <span class="o">&lt;</span><span class="n">llvm</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">directory</span><span class="o">&gt;</span>
</pre></div>
</div>
<section id="supported-llvm-versions">
<h3>Supported LLVM versions<a class="headerlink" href="#supported-llvm-versions" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Note that pocl aims to support <strong>the latest LLVM version</strong> at the time
of pocl release, <strong>plus the previous</strong> LLVM version. All older LLVM
versions are supported with “best effort” basis; there might not be
CI continuously testing the code base nor anyone fixing their
possible breakage.</p>
</div></blockquote>
</section>
</section>
<section id="configure-build">
<h2>Configure &amp; Build<a class="headerlink" href="#configure-build" title="Permalink to this headline">¶</a></h2>
<p>CMake version 3.12 or higher is required.</p>
<p>The build+install is the usual CMake way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">directory</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">pocl</span><span class="o">-</span><span class="n">sources</span><span class="o">&gt;</span>
<span class="n">mkdir</span> <span class="n">build</span>
<span class="n">cd</span> <span class="n">build</span>
<span class="n">cmake</span> <span class="p">[</span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">option</span><span class="o">&gt;=&lt;</span><span class="n">value</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span> <span class="o">..</span>
<span class="n">make</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
<p>To see the default detected values, run <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">..</span></code> without any options,
it will produce a summary.</p>
<section id="cmake-variables">
<h3>CMake variables<a class="headerlink" href="#cmake-variables" title="Permalink to this headline">¶</a></h3>
<p>Since pocl includes a compiler for the kernels, it both compiles (producing
code) and is compiled (it consists of code). This distinction typically called
“host” and “target”: The host is where pocl is running, the target is
where the OpenCL code will be running. These two systems can be wildly
different.</p>
<p>Host compiler used to compile pocl can be GCC or Clang; the target
compiler is always Clang+LLVM since pocl uses Clang/LLVM internally.
For host compiler, you should use the one which your LLVM was compiled
with (because the LLVM-related parts of pocl take LLVM’s CXXFLAGS from
llvm-config and pass them to the host compiler).</p>
</section>
<section id="cmake-host-flags">
<h3>CMake host flags<a class="headerlink" href="#cmake-host-flags" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>Compile C:</dt><dd><p>CMAKE_C_FLAGS
CMAKE_C_FLAGS_&lt;build-type&gt;</p>
</dd>
<dt>Compile C++:</dt><dd><p>CMAKE_CXX_FLAGS
CMAKE_CXX_FLAGS_&lt;build-type&gt;</p>
</dd>
</dl>
</section>
<section id="building-kernels-and-the-kernel-library-i-e-target-flags">
<h3>Building kernels and the kernel library, i.e. target flags<a class="headerlink" href="#building-kernels-and-the-kernel-library-i-e-target-flags" title="Permalink to this headline">¶</a></h3>
<p>All of these empty by default. There are hardcoded defaults which may
be overridden by setting these variables (rarely needed).</p>
<dl class="simple">
<dt>Extra parameters to llc</dt><dd><p>EXTRA_HOST_LLC_FLAGS</p>
</dd>
<dt>Extra parameters to clang</dt><dd><p>EXTRA_HOST_CLANG_FLAGS</p>
</dd>
</dl>
<p>Extra parameters to linker (links kernel to shared library
which is then dlopened):</p>
<p>EXTRA_HOST_LD_FLAGS</p>
<dl class="simple">
<dt>EXTRA_KERNEL_FLAGS</dt><dd><p>is applied to all kernel library compilation commands, IOW it’s for
language-independent options</p>
</dd>
<dt>EXTRA_KERNEL_{C,CL,CXX}_FLAGS</dt><dd><p>cmake variables for per-language options for kernel library compilation</p>
</dd>
</dl>
</section>
<section id="cmake-other-options-features">
<span id="pocl-cmake-variables"></span><h3>CMake: other options &amp; features<a class="headerlink" href="#cmake-other-options-features" title="Permalink to this headline">¶</a></h3>
<p>Note that there are a few more packaging-related options described
in <code class="docutils literal notranslate"><span class="pre">README.packaging</span></code>.</p>
<p>For multiple-item options like KERNELLIB_HOST_CPU_VARIANTS,
use “;” as separator (you’ll have to escape it for bash).</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">-DWITH_LLVM_CONFIG=&lt;path-to-llvm-config&gt;</span></code>
<strong>IMPORTANT</strong> Path to a llvm-config binary.
This determines the LLVM installation used by pocl.
If not specified, pocl will try to find and link against
llvm-config in PATH env var (usually means your system LLVM).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DSTATIC_LLVM</span></code> pocl uses <code class="docutils literal notranslate"><span class="pre">llvm-config</span> <span class="pre">--libs</span></code> to get list of LLVM libraries
it should link to. With this flag enabled, it additionally passes <code class="docutils literal notranslate"><span class="pre">--link-static</span></code>
to <code class="docutils literal notranslate"><span class="pre">llvm-config</span></code>; otherwise it passes <code class="docutils literal notranslate"><span class="pre">--link-shared</span></code>. Default is OFF (=shared).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DENABLE_ICD</span></code> By default pocl’s buildsystem will try to find an ICD
and build pocl as a dynamic library named “libpocl”. This option is useful
if you want to avoid ICD and build pocl directly as libOpenCL library.
See also <a class="reference internal" href="using.html#linking-with-icd"><span class="std std-ref">Linking your program with pocl through an icd loader</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DPOCL_INSTALL_&lt;something&gt;_DIR</span></code> The equivalent of <code class="docutils literal notranslate"><span class="pre">--bindir</span></code>,
<code class="docutils literal notranslate"><span class="pre">--sbindir</span></code> etc fine-tuning of paths for autotools. See the beginning
of toplevel CMakeLists.txt for all the variables.</p>
<p>Note that if <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code> equals <code class="docutils literal notranslate"><span class="pre">/usr</span></code> then pocl.icd is
installed to <code class="docutils literal notranslate"><span class="pre">/etc/OpenCL/vendors</span></code>, otherwise it’s installed to
<code class="docutils literal notranslate"><span class="pre">${CMAKE_INSTALL_PREFIX}/etc/OpenCL/vendors</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DLLC_HOST_CPU=&lt;something&gt;</span></code>
Defaults to auto-detection via <code class="docutils literal notranslate"><span class="pre">llc</span></code>. Run <code class="docutils literal notranslate"><span class="pre">llc</span> <span class="pre">-mcpu=help</span></code>
for valid values. The CPU type is required to compile
the “target” (kernel library) part of CPU backend.</p>
<p>This variable overrides LLVM’s autodetected host CPU at configure time.
Useful when llc fails to detect the CPU (often happens on non-x86
platforms, or x86 with CPU newer than LLVM).</p>
<p>Note that when this is set (set by default) and the
KERNELLIB_HOST_CPU_VARIANTS variable is not <code class="docutils literal notranslate"><span class="pre">distro</span></code>,
pocl will first try to find compiled kernel library
for runtime-detected CPU then fallback to LLC_HOST_CPU.
This works well if pocl is run where it was built,
or the actual CPU is in the KERNELLIB_HOST_CPU_VARIANTS list,
or the actual CPU is &gt;= LLC_HOST_CPU feature-wise;
otherwise it will likely fail with illegal instruction at runtime.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DKERNELLIB_HOST_CPU_VARIANTS</span></code> You can control which CPUs the
“target” part of CPU backend will be built for.
Unlike LLC_HOST_CPU, this variable is useful if you plan
to build for multiple CPUs. Defaults to “native” which is
automagically replaced by LLC_HOST_CPU.
Available CPUs are listed by <code class="docutils literal notranslate"><span class="pre">llc</span> <span class="pre">-mcpu=help</span></code>. See above for
runtime CPU detection rules.</p>
<p>Note that there’s another valid value on x86(64) platforms.
If set to <code class="docutils literal notranslate"><span class="pre">distro</span></code>, the KERNELLIB_HOST_CPU_VARIANTS variable will be
set up with a few preselected sse/avx variants covering 99.99% of x86
processors, and the runtime CPU detection is slightly altered: pocl
will find the suitable compiled library based on detected CPU features,
so it cannot fail (at worst it’ll degrade to SSE2 library).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DLLC_TRIPLE=&lt;something&gt;</span></code> Controls what target triple pocl is built for.
You can set this manually in case the autodetection fails.
Example value: <code class="docutils literal notranslate"><span class="pre">x86_64-pc-linux-gnu</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DENABLE_TESTSUITES</span></code> Which external (source outside pocl) testsuites to enable.
For the list of testsuites, see examples/CMakeLists.txt or the <code class="docutils literal notranslate"><span class="pre">examples</span></code>
directory. Set to <code class="docutils literal notranslate"><span class="pre">all</span></code> and pocl will try to autodetect &amp; enable everything
it can.</p>
<p>Note that you may build testsuites outside pocl’s build tree, and test
multiple pocl builds with a single testsuite directory. To use this,
run cmake with <code class="docutils literal notranslate"><span class="pre">-DTESTSUITE_BASEDIR=&lt;tests-builddir&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">-DTESTSUITE_SOURCE_BASEDIR=&lt;tests-sourcedir&gt;</span></code>.
The directory structure mirrors that of <code class="docutils literal notranslate"><span class="pre">pocl/examples</span></code>. So to build e.g. AMD SDK 2.9
with <code class="docutils literal notranslate"><span class="pre">-DTESTSUITE_BASEDIR=/home/pocltest-build</span> <span class="pre">-DTESTSUITE_SOURCE_BASEDIR=/home/pocltest-src</span></code>,
place the <code class="docutils literal notranslate"><span class="pre">AMD-APP-SDK-v2.9-RC-lnx64.tgz</span></code> file into <code class="docutils literal notranslate"><span class="pre">/home/pocltest-src/AMDSDK2.9</span></code> directory.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DENABLE_TESTS=ON/OFF</span></code> enable/disable compilation of internal tests.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DENABLE_EXAMPLES=ON/OFF</span></code> enable/disable compilation of all examples.
Disabling this makes ENABLE_TESTSUITES option unavailable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DENABLE_POCLCC=ON/OFF</span></code> enable/disable compilation of poclcc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DENABLE_CONFORMANCE=ON/OFF</span></code>
Ensures that certain build options which would result in non-conformant pocl
build stay disabled. Defaults to OFF. Note that this does not quarantee a
fully conformant build of pocl by itself. See <a class="reference internal" href="conformance.html#pocl-conformance"><span class="std std-ref">OpenCL conformance</span></a> for details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DENABLE_{A,L,T,UB}SAN</span></code> - compiles pocl’s host code (and tests
+ examples) with various sanitizers. Using more than one sanitizer at
a time is untested. Using together with <code class="docutils literal notranslate"><span class="pre">-DENABLE_ICD=OFF</span> <span class="pre">-DENABLE_LOADABLE_DRIVERS=OFF</span></code>
is highly recommended to avoid issues with loading order of sanitizer libraries.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DENABLE_LTTNG=ON/OFF</span></code> - compile pocl with LTTng support for tracing. Requires LTTng to be installed
on the host machine.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DENABLE_{CUDA,TCE,HSA,VULKAN,LEVEL0}=ON/OFF</span></code> - enable various (non-CPU) backends.
Usually requires some additional build dependencies; see their documentation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DPOCL_DEBUG_MESSAGES=ON</span></code> - when disabled, pocl is compiled without
debug messages (POCL_DEBUG env var) support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DEXAMPLES_USE_GIT_MASTER=ON</span></code> - when enabled, examples (external
programs in <code class="docutils literal notranslate"><span class="pre">examples/</span></code> directory) are built from their git branches
(if available), as opposed to default: building from release tars.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DENABLE_POCL_FLOAT_CONVERSION=ON/OFF</span></code>
When enabled, OpenCL printf() call’s f/e/g formatters are handled by pocl.
When disabled (default), these are handled by system C library.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-DINTEL_SDE_AVX512=&lt;PATH&gt;</span></code>
Path to Intel® Software Development Emulator. When this option is given,
the LLVM host CPU is forcibly set to ‘skylake-avx512’, and the internal
tests are run through the Emulator. Mostly useful to test AVX512.</p></li>
</ul>
</section>
<section id="llvm-less-build">
<span id="pocl-without-llvm"></span><h3>LLVM-less build<a class="headerlink" href="#llvm-less-build" title="Permalink to this headline">¶</a></h3>
<p>You can build a runtime-only pocl to run prebuilt pocl binaries on a device.
To do this</p>
<ul>
<li><p>First, build a pocl with LLVM somewhere.</p></li>
<li><p>on that machine, set up env vars required for your device (if any), then
run <code class="docutils literal notranslate"><span class="pre">bin/poclcc</span> <span class="pre">-l</span></code>. That should print something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LIST</span> <span class="n">OF</span> <span class="n">DEVICES</span><span class="p">:</span>
<span class="mi">0</span><span class="p">:</span>
 <span class="n">Vendor</span><span class="p">:</span>   <span class="n">AuthenticAMD</span>
   <span class="n">Name</span><span class="p">:</span>   <span class="n">pthread</span><span class="o">-</span><span class="n">AMD</span> <span class="n">A10</span><span class="o">-</span><span class="mi">7800</span> <span class="n">Radeon</span> <span class="n">R7</span><span class="p">,</span> <span class="mi">12</span> <span class="n">Compute</span> <span class="n">Cores</span> <span class="mi">4</span><span class="n">C</span><span class="o">+</span><span class="mi">8</span><span class="n">G</span>
<span class="n">Version</span><span class="p">:</span>   <span class="n">OpenCL</span> <span class="mf">2.0</span> <span class="n">pocl</span> <span class="n">HSTR</span><span class="p">:</span> <span class="n">pthread</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">-</span><span class="n">bdver3</span>
</pre></div>
</div>
</li>
</ul>
<p>The string after “HSTR:” is the device build hash.</p>
<ul>
<li><p>now build the LLVM-less pocl. You will need the device build hash from
previous step:</p>
<p><code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-DENABLE_LLVM=0</span> <span class="pre">-DHOST_DEVICE_BUILD_HASH=&lt;something&gt;</span> <span class="pre">...</span></code></p>
<p>This is required because pocl binaries contain a device hash, and the LLVM-less
pocl needs to know which binaries it can load.</p>
</li>
</ul>
<p><strong>NOTE</strong>: If you’ve enabled the <a class="reference internal" href="almaif.html#almaif-usage"><span class="std std-ref">almaif device</span></a>
, <cite>HOST_DEVICE_BUILD_HASH</cite> can be set to anything you want. Reason being, fixed function
accelerators don’t require compiling OpenCL kernels, therefore, no hash will ever be matched.</p>
</section>
</section>
<section id="cross-compile-pocl">
<h2>Cross-compile PoCL<a class="headerlink" href="#cross-compile-pocl" title="Permalink to this headline">¶</a></h2>
<p>It’s now possible to cross-compile pocl on x86-64 to run on ARM/MIPS/etc,
There is a ToolchainExample.cmake file;
copy it under different name, then follow the instructions in the file.</p>
</section>
<section id="known-build-time-issues">
<h2>Known build-time issues<a class="headerlink" href="#known-build-time-issues" title="Permalink to this headline">¶</a></h2>
<p>There are unsolved issues and bugs in pocl. See the bug listing
for a complete listing at <a class="reference external" href="https://github.com/pocl/pocl/issues">https://github.com/pocl/pocl/issues</a></p>
</section>
<section id="building-running-in-docker">
<h2>Building &amp; running in Docker<a class="headerlink" href="#building-running-in-docker" title="Permalink to this headline">¶</a></h2>
<p>Make sure you have enough space (default location is usually <code class="docutils literal notranslate"><span class="pre">/var/lib/docker</span></code>,
required storage for standard pocl build is about 1.5 GB per container)</p>
<section id="build-start-pocl-container">
<h3>Build &amp; start Pocl container<a class="headerlink" href="#build-start-pocl-container" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">tools/docker</span></code></p></li>
<li><p>pick a Dockerfile from tools/docker, e.g. Fedora/default</p></li>
<li><p>to build PoCL: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">build</span> <span class="pre">-t</span> <span class="pre">TAG</span> <span class="pre">-f</span> <span class="pre">Fedora/default</span> <span class="pre">.</span></code>, where
TAG is a name you choose for the build (must be lowercase)</p></li>
<li><p>to run the tests on the built PoCL: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-t</span> <span class="pre">TAG</span></code></p></li>
<li><p>this will by default use master branch of pocl git; to use a different branch/commit,
run docker build with <code class="docutils literal notranslate"><span class="pre">--build-arg</span> <span class="pre">GIT_COMMIT=&lt;branch/commit&gt;</span></code></p></li>
</ul>
</section>
<section id="dockerfiles">
<h3>Dockerfiles<a class="headerlink" href="#dockerfiles" title="Permalink to this headline">¶</a></h3>
<p>Note that some images (e.g. RHEL and PHSA) may be impossible to build,
due to not having a sufficiently new version of LLVM available.</p>
<p>Dockerfiles are named according to what they build, or the release they’re based on:</p>
<ul class="simple">
<li><dl class="simple">
<dt><cite>default</cite>: builds pocl, then runs the internal tests from build dir.</dt><dd><p>Uses latest release of a distribution, with whatever is the default version of LLVM.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>distro</cite>: does a distribution-friendly build: enables runtime detection of CPU,</dt><dd><p>installs pocl into system path, then runs the internal tests</p>
</dd>
</dl>
</li>
<li><p><cite>&lt;release&gt;</cite>: same as above, except uses specific release and specific LLVM version
(the latest available in that release).</p></li>
<li><p><cite>conformance</cite>: builds &amp; installs Pocl, then runs conformance test suite
(the shortest version of it)</p></li>
</ul>
</section>
</section>
<section id="arm-32-64bit-support">
<h2>ARM 32/64bit support<a class="headerlink" href="#arm-32-64bit-support" title="Permalink to this headline">¶</a></h2>
<p>Status:</p>
<p>PoCL builds (as of Dec 2023) on ODROID XU3 and ODROID C2
and almost all tests pass.</p>
<p>ARM specific build notes:</p>
<ul class="simple">
<li><p>DO NOT use Clang/LLVM downloaded directly from llvm.org, they only work
on the distro where they were compiled. Ubuntu LTS these days ships multiple llvm
versions even quite recent ones; get Clang+LLVM from your distro’s package
manager or build it yourself.</p></li>
<li><p>LLVM might not recognize your cpu, in which case CMake will complain.
Run cmake with -DLLC_HOST_CPU=&lt;yourcpu&gt;. “yourcpu” must be something LLVM recognizes,
usually it’s simply “cortex-aXX” like cortex-a15 etc. You can get the full list by
running <cite>llc -mcpu=help</cite>.</p></li>
</ul>
</section>
<section id="risc-v-support">
<h2>RISC-V support<a class="headerlink" href="#risc-v-support" title="Permalink to this headline">¶</a></h2>
<p>The RISC-V support has been tested (as of Dec 2023) on Starfive VisionFive 2 using Ubuntu 23.10 preinstalled image,
with LLVM 17 and GCC 13.2; of the internal tests, 98% tests pass, 4 tests fail out of 253.
In particular, tests using printf with vector arguments are broken ATM. Other boards / CPUs
have not been tested. RISC Vector extension is not supported.</p>
<p>RISC-V specific build notes:</p>
<ul>
<li><p>Avoid older LLVM and GCC versions (like GCC 11 / Clang 14 on the official
Starfive Debian images) as much as possible. Code generation is much
better with recent versions, and your experience will generally better</p></li>
<li><p>LLVM might not recognize your CPU, in which case CMake will complain.
Run cmake with -DLLC_HOST_CPU=&lt;yourcpu&gt;. “yourcpu” must be something LLVM recognizes;
you can get the full list by running <cite>llc -mcpu=help</cite>.</p></li>
<li><p>on RISC-V, PoCL additionally needs to pass a target ABI flag to the compiler. There is
some autodetection in PoCL but right now it’s limited, and Clang unfortunately does not
always get the defaults correctly. If you get errors similar to:</p>
<blockquote>
<div><p>“can’t link double-float modules with soft-float modules”</p>
</div></blockquote>
<p>from linker, then most likely PoCL used the incorrect ABI. You can explicitly
specify the ABI to use with the HOST_CPU_TARGET_ABI CMake option.</p>
</li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Installation</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#installing-requirements-for-ubuntu">Installing requirements for Ubuntu</a></li>
<li><a class="reference internal" href="#opencl-3-0-support">OpenCL 3.0 support</a></li>
<li><a class="reference internal" href="#clang-llvm-notes">Clang / LLVM Notes</a><ul>
<li><a class="reference internal" href="#supported-llvm-versions">Supported LLVM versions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure-build">Configure &amp; Build</a><ul>
<li><a class="reference internal" href="#cmake-variables">CMake variables</a></li>
<li><a class="reference internal" href="#cmake-host-flags">CMake host flags</a></li>
<li><a class="reference internal" href="#building-kernels-and-the-kernel-library-i-e-target-flags">Building kernels and the kernel library, i.e. target flags</a></li>
<li><a class="reference internal" href="#cmake-other-options-features">CMake: other options &amp; features</a></li>
<li><a class="reference internal" href="#llvm-less-build">LLVM-less build</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cross-compile-pocl">Cross-compile PoCL</a></li>
<li><a class="reference internal" href="#known-build-time-issues">Known build-time issues</a></li>
<li><a class="reference internal" href="#building-running-in-docker">Building &amp; running in Docker</a><ul>
<li><a class="reference internal" href="#build-start-pocl-container">Build &amp; start Pocl container</a></li>
<li><a class="reference internal" href="#dockerfiles">Dockerfiles</a></li>
</ul>
</li>
<li><a class="reference internal" href="#arm-32-64bit-support">ARM 32/64bit support</a></li>
<li><a class="reference internal" href="#risc-v-support">RISC-V support</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to Portable Computing Language (pocl)’s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="using.html"
                        title="next chapter">Usage</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/install.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="using.html" title="Usage"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to Portable Computing Language (pocl)’s documentation!"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Portable Computing Language (PoCL) 6.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Installation</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2023 PoCL developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>